# 数据构建

## 1  从规程规章制度等文件中生成InternLM2模型*Xtuner*训练数据格式

1.1  输入如下命令，会在data目录下生成CoalQA_data.json

```shell
python  Generate_QAdata.py  ../data/CoalQA_data.json
```

CoalQA_data.json内容结构形如：

```shell
[
  {
    "input": "请提供新建矿井立井井筒冻结法施工的具体要求。",
    "output": "新建矿井立井井筒冻结法施工需要遵守以下要求：冻结深度必须穿过风化带延深至稳定的基岩10m以上，第一个冻结孔必须全孔取芯，钻孔时必须测定钻孔的方向和偏斜度，偏斜度超过规定时必须及时纠正，冻结管必须采用无缝钢管并焊接或螺纹连接，开始冻结后必须经常观察水文观测孔的水位变化，并在确定冻结壁已交圈后才能进行试挖。"
  },
  ...
  
]
```

1.2  接上面生成json，处理成Xtuner可训练数据格式，运行下面命令即可

```shell
python format_internlm2.py  
```

```shell
[
    {
        "conversation": [
            {
                "system": "你是一个煤矿安全领域的知识达人，你对相关煤矿安全规章规程制度、技术等文档非常熟悉。请你专业正确地解答用户想问的煤矿安全相关问题。",
                "input": "请提供新建矿井立井井筒冻结法施工的具体要求。",
                "output": "新建矿井立井井筒冻结法施工需要遵守以下要求：冻结深度必须穿过风化带延深至稳定的基岩10m以上，第一个冻结孔必须全孔取芯，钻孔时必须测定钻孔的方向和偏斜度，偏斜度超过规定时必须及时纠正，冻结管必须采用无缝钢管并焊接或螺纹连接，开始冻结后必须经常观察水文观测孔的水位变化，并在确定冻结壁已交圈后才能进行试挖。"
            }
        ]
    },
    {
        "conversation": [
            {
                "system": "你是一个煤矿安全领域的知识达人，你对相关煤矿安全规章规程制度、技术等文档非常熟悉。请你专业正确地解答用户想问的煤矿安全相关问题。",
                "input": "煤矿安全规程中，对于新建矿井的立井井筒冻结法施工有哪些具体要求？",
                "output": "新建矿井立井井筒冻结法施工需要遵守以下要求：冻结深度必须穿过风化带延深至稳定的基岩10m以上，第一个冻结孔必须全孔取芯，钻孔时必须测定钻孔的方向和偏斜度，偏斜度超过规定时必须及时纠正，冻结管必须采用无缝钢管并焊接或螺纹连接，开始冻结后必须经常观察水文观测孔的水位变化，并在确定冻结壁已交圈后才能进行试挖。"
            }
        ]
    },
...
]
```

## 2  从整理好的题库生成InternLM2模型*Xtuner*训练数据格式

输入如下命令即可

```shell
python Generate_Question_bank.py
```

这里展示多选题生成

```shell
[
    {
        "conversation": [
            {
                "system": "你是一个煤矿安全领域的知识达人，你会解答很多题。用户给出一个多选题，你能从几个选项中，选择出多个正确选项。",
                "input": "掘进巷道在下列哪些情况下不能爆破()。\nA、掘进工作面或炮眼有突水预兆时\nB、探水孔超前距不够时\nC、空顶距超过规定时\nD、掘进工作面支架不牢固时",
                "output": "ABCD"
            }
        ]
    },
    ...
]
```

若想生成其他题目类型训练数据，请在相应位置替换成需要的内容
```shell
csv_filename = '../data/多选题.csv'
# csv_filename = '../data/单选题.csv'
# csv_filename = '../data/判断题.csv'
# csv_filename = '../data/填空题.csv'
# csv_filename = '../data/简答题.csv'

json_filename = '../data/multiple_choice.json'
# json_filename = '../data/single_choice.json'
# json_filename = '../data/true_or_false.json'
# json_filename = '../data/fill_in.json'
# json_filename = '../data/shot_answer.json'

 "system": "你是一个煤矿安全领域的知识达人，你会解答很多题。用户给出一个多选题，你能从几个选项中，选择出多个正确选项。"
# "system": "你是一个煤矿安全领域的知识达人，你会解答很多题。用户给出一个单选题，你能从几个选项中，选择出一个正确选项。"
# "system": "你是一个煤矿安全领域的知识达人，你会解答很多题。用户给出一个判断题，然后你作出判断，是正确还是错误。"
# "system": "你是一个煤矿安全领域的知识达人，你会解答很多题。用户给出一个填空题，然后你在题目中括号中，填写合适的答案"
#  "system": "你是一个煤矿安全领域的知识达人，你对相关煤矿安全规章规程制度、技术等文档非常熟悉。请你专业正确地解答用户想问的煤矿安全相关问题。"
```
## 3  煤矿事故多轮对话生成

```shell
"""
""{accident}""
通过上面提供的事故调查事故报告，请你帮我生成多轮对话文本，格式为[
    {
        "conversation": [
            {
                "system": "你是一名煤矿安全领域的知识达人，提供有关煤矿安全规程、事故预防措施和应急响应的知识。",
                "input": "你好！",
                "output": "您好，我是一名煤矿安全领域的知识达人，请问有什么可以帮助您？"
            },
            {
                "input": " ",
                "output": " "
            }，...
        ]
    }
]
"""
```

```shell

{
        "conversation": [
            {
                "system": "你是一名煤矿安全领域的知识达人，提供有关煤矿安全规程、事故预防措施和应急响应的知识。",
                "input": "你好！",
                "output": "您好，我是一名煤矿安全领域的知识达人，请问有什么可以帮助您？"
            },
            {
                "input": "2023年3月22日子长县中达焦家沟煤业有限公司发生了什么事故？",
                "output": "2023年3月22日2时56分左右，子长县中达焦家沟煤业有限公司5309轨道顺槽发生其他事故，造成1人死亡，直接经济损失175万元。"
            },
            {
                "input": "事故的直接原因是什么？",
                "output": "事故的直接原因是矿井将不符合公称压力强度要求的管路作为瓦斯抽放管使用，在对瓦斯抽放管进行气密性试验的过程中瓦斯抽放管连接法兰处漏气，现场作业人员违反安全技术措施在瓦斯抽放管未泄压完毕的情况下用梅花扳手紧固漏气的法兰螺丝，维修过程中管路受力失衡爆裂，作业人员被喷出的冲击波击中，导致事故发生。"
            },
            {
                "input": "事故的间接原因有哪些？",
                "output": "事故的间接原因包括：\n1. 安全生产责任落实不力，管理制度执行不严格。\n2. 现场安全管理差，违章冒险作业。\n3. 技术管理有漏洞，技术人员业务素质低。\n4. 安全教育培训效果差，职工安全意识淡薄。\n5. 安全监管存在不足。"
            },
            {
                "input": "如何改进企业的安全生产责任落实？",
                "output": "改进企业的安全生产责任落实的方法包括：\n1. 明确设备材料管理制度，确保采购把关严格，合同明确产品具体型号和使用范围。\n2. 制定并落实管路使用和回收的管理制度，明确责任主体。\n3. 加强日常维护保养，确保设备材料的安全使用。\n4. 严格执行《安全技术措施审批制度》等安全管理制度，确保安全生产责任落实到位。"
            },
            {
                "input": "如何加强现场安全管理，避免违章冒险作业？",
                "output": "加强现场安全管理的方法包括：\n1. 全面分析和辨识作业风险，制定详细的安全技术措施。\n2. 确保现场作业人员严格遵守安全操作规程，禁止违章冒险作业。\n3. 增强现场监督管理，确保有安全员和负责人进行现场安全监督。\n4. 实现专业队伍化，确保瓦斯抽放管路敷设和测试等工作由专业队伍执行。"
            },
            {
                "input": "如何提高技术管理水平？",
                "output": "提高技术管理水平的方法包括：\n1. 加强安全技术规范的学习和掌握，确保技术人员了解相关标准和要求。\n2. 科学编制安全技术措施，选择更安全的工艺和方法。\n3. 严格执行安全技术措施会审制度，确保措施科学合理。\n4. 确保作业人员严格执行安全技术措施，避免违章操作。\n5. 进行全面的风险分析和研判，辨识并防范可能的安全风险。"
            },
            {
                "input": "如何改进安全教育培训效果？",
                "output": "改进安全教育培训效果的方法包括：\n1. 制定详细的培训计划，确保职工全面掌握安全技术措施。\n2. 提高培训的实际操作性，通过实操训练提高职工的安全意识和技能。\n3. 加强对作业环境的安全风险辨识培训，提升职工的自保互保意识。\n4. 定期进行培训考核，检验培训效果，确保培训内容深入人心。"
            },
            {
                "input": "如何增强安全监管力度？",
                "output": "增强安全监管力度的方法包括：\n1. 明确驻矿安检员的职责，确保其全面掌握煤矿安全生产状况。\n2. 加强安全监管分工，确保各项监管工作责任到人。\n3. 进行定期和不定期的安全检查，发现并整改安全隐患。\n4. 建立健全安全监管考核制度，确保安全监管工作落实到位。"
            }
        ]
    }
```
使用GLM-4模型，构建煤矿事故知识图谱。暂时不开源

##  补充细节
- 1.合并两个json文件的脚本：merge_json.py

- 2.格式化json文本的脚本：format_json.py

- 3.打乱json中数据顺序的脚本：shuffle.py

